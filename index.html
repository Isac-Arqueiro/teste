<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPTV Smart TV</title>
<link rel="icon" href="https://i.imgur.com/jFQiZvL.jpeg">
<style>
body{margin:0;padding:0;background:#101010;color:#fff;font-family:sans-serif;overflow:hidden;}
#login{height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:15px;}
#login input{padding:12px;width:260px;text-align:center;border-radius:6px;border:none;background:#222;color:#fff;}
#login button{padding:10px 20px;border:none;border-radius:6px;background:#1e90ff;color:#fff;cursor:pointer;}
.container{display:none;height:100vh;flex-direction:row;}
.sidebar{width:260px;background:#111;overflow-y:auto;padding:10px;}
.sidebar button{width:100%;padding:10px;margin:5px 0;background:#181818;border:none;color:#fff;border-radius:6px;cursor:pointer;}
.sidebar button:focus{outline:2px solid #1e90ff;}
.main{flex:1;position:relative;}
#playerContainer{width:100%;height:100%;background:#000;display:none;position:relative;}
#playerContainer.active{display:block;}
video{width:100%;height:100%;background:#000;}
.player-controls{position:absolute;bottom:15px;left:50%;transform:translateX(-50%);display:flex;gap:10px;}
.player-controls button{padding:6px 12px;border-radius:6px;background:rgba(0,0,0,0.55);color:#fff;border:1px solid #333;cursor:pointer;}
.channel-list{margin-top:10px;}
.channel{display:flex;align-items:center;padding:8px;border-radius:6px;cursor:pointer;background:#181818;margin:4px 0;}
.channel img{width:50px;height:50px;margin-right:10px;border-radius:4px;}
.channel:focus{outline:2px solid #1e90ff;background:#222;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login">
  <h2>Bem-vindo ao IPTV</h2>
  <input type="password" id="password" placeholder="Digite a senha">
  <button id="loginBtn">Entrar</button>
</div>

<!-- CONTAINER PRINCIPAL -->
<div class="container">
  <div class="sidebar">
    <button id="btnAll">Todas Categorias</button>
    <button id="btnFav">Favoritos</button>
    <div id="categories"></div>
  </div>
  <div class="main">
    <div id="playerContainer">
      <video id="video" playsinline webkit-playsinline></video>
      <div class="player-controls">
        <button id="exitBtn">Menu</button>
        <button id="prevBtn">⏮️</button>
        <button id="nextBtn">⏭️</button>
        <button id="fullscreenBtn">⛶</button>
      </div>
    </div>
    <div id="channelListRight" class="channel-list"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
// ======== CONFIGURAÇÃO ========
const validPasswords = ["2025","A0C02550","A0X02551","A0Z02552"];
const playlistUrl = "https://raw.githubusercontent.com/Isac-Arqueiro/vip01/refs/heads/main/canais";
let allChannels = [], favorites = JSON.parse(localStorage.getItem("favorites")||"[]"), currentIndex=0;
const loginDiv = document.getElementById("login"), container = document.querySelector(".container");
const channelListRight = document.getElementById("channelListRight");
const videoContainer = document.getElementById("playerContainer"), videoEl = document.getElementById("video");
let hls=null;

// ======== LOGIN ========
document.getElementById("loginBtn").onclick = ()=> {
  const pw=document.getElementById("password").value;
  if(validPasswords.includes(pw)){ 
    localStorage.setItem("iptv_pw",pw); 
    loginDiv.style.display="none"; 
    container.style.display="flex"; 
    loadPlaylist(); 
  } else alert("Senha incorreta!");
};
window.onload=()=> {
  if(validPasswords.includes(localStorage.getItem("iptv_pw"))){ 
    loginDiv.style.display="none"; 
    container.style.display="flex"; 
    loadPlaylist(); 
  }
};

// ======== CARREGAR LISTA ========
async function loadPlaylist(){
  try{
    const res = await fetch(playlistUrl);
    const txt = await res.text();
    allChannels=parseM3U(txt);
    renderCategories();
  }catch{ alert("Erro ao carregar lista"); }
}
function parseM3U(txt){
  const lines=txt.split("\n"), channels=[];
  let c=null;
  lines.forEach(l=>{
    l=l.trim();
    if(l.startsWith("#EXTINF")) c={tvg_name:(l.match(/tvg-name="([^"]+)"/)||["","Sem Nome"])[1], tvg_logo:(l.match(/tvg-logo="([^"]+)"/)||["",""])[1], group_title:(l.match(/group-title="([^"]+)"/)||["","Outros"])[1]};
    else if(l && c){c.url=l; channels.push(c); c=null;}
  });
  return channels;
}

// ======== RENDER CATEGORIAS ========
const categoriesDiv=document.getElementById("categories");
function renderCategories(){
  const cats=[...new Set(allChannels.map(c=>c.group_title))];
  categoriesDiv.innerHTML="";
  cats.forEach(cat=>{
    const btn=document.createElement("button");
    btn.textContent=cat;
    btn.onclick=()=>renderChannels(allChannels.filter(c=>c.group_title===cat));
    btn.tabIndex=0;
    categoriesDiv.appendChild(btn);
  });
  renderChannels(allChannels);

  // >>> COMEÇAR COM "TODAS CATEGORIAS" SELECIONADO
  document.getElementById("btnAll").focus();
}

// ======== RENDER CANAIS ========
function renderChannels(channels){
  channelListRight.innerHTML="";
  channels.forEach((c,i)=>{
    const div=document.createElement("div");
    div.className="channel"; div.tabIndex=0;
    div.innerHTML=`<img src="${c.tvg_logo||'https://via.placeholder.com/50'}"><span>${c.tvg_name}</span>`;
    div.onclick=()=>{currentIndex=i; playChannel(c);};
    channelListRight.appendChild(div);
  });
}

// ======== PLAY CHANNEL COM FULLSCREEN ========
function playChannel(c){
  if(hls){ hls.destroy(); hls=null; }

  videoContainer.classList.add("active");
  videoEl.pause();
  videoEl.src="";

  // FULLSCREEN AUTOMÁTICO
  if(videoEl.requestFullscreen){
      videoEl.requestFullscreen().catch(()=>{});
  }

  if(c.url.includes(".m3u8") && Hls.isSupported()){
    hls=new Hls({enableWorker:false});
    hls.loadSource(c.url);
    hls.attachMedia(videoEl);
    hls.on(Hls.Events.MANIFEST_PARSED,()=>videoEl.play());
    hls.on(Hls.Events.ERROR,()=>{
      videoEl.src=c.url;
      videoEl.play().catch(()=>{});
    });
  } else {
    videoEl.src=c.url;
    videoEl.play().catch(()=>{});
  }
}

// ======== FULLSCREEN AO APERTAR OK NO PLAYER ========
videoEl.addEventListener("click", () => {
    if(videoEl.requestFullscreen){
        videoEl.requestFullscreen().catch(()=>{});
    }
});
document.addEventListener("keydown", (e) => {
    if(e.key === "Enter" && videoContainer.classList.contains("active")){
        if(videoEl.requestFullscreen){
            videoEl.requestFullscreen().catch(()=>{});
        }
    }
});

// ======== CONTROLES PLAYER ========
document.getElementById("exitBtn").onclick=()=>{ videoContainer.classList.remove("active"); videoEl.pause(); };
document.getElementById("prevBtn").onclick=()=>{ currentIndex=(currentIndex-1+allChannels.length)%allChannels.length; playChannel(allChannels[currentIndex]); };
document.getElementById("nextBtn").onclick=()=>{ currentIndex=(currentIndex+1)%allChannels.length; playChannel(allChannels[currentIndex]); };
document.getElementById("fullscreenBtn").onclick=()=>{ if(videoEl.requestFullscreen) videoEl.requestFullscreen(); };

// ======== NAVEGAÇÃO CORRIGIDA PARA TV BOX ========
document.addEventListener('keydown', (e) => {
    const sidebar = document.querySelector('.sidebar');
    const categoriesBtns = [...sidebar.querySelectorAll('#categories button')];
    const allBtn = document.getElementById('btnAll');
    const favBtn = document.getElementById('btnFav');
    const channelsDivs = [...document.querySelectorAll('#channelListRight .channel')];
    const active = document.activeElement;

    switch(e.key){
        case "ArrowUp":
            if(active.classList.contains('channel') && active.previousElementSibling){
                active.previousElementSibling.focus();
            } else if(active === favBtn){
                allBtn.focus();
            } else if(active === allBtn){
                // nada
            } else if(categoriesBtns.includes(active)){
                const idx = categoriesBtns.indexOf(active);
                if(idx > 0) categoriesBtns[idx-1].focus();
                else favBtn.focus();
            }
            break;

        case "ArrowDown":
            if(active.classList.contains('channel') && active.nextElementSibling){
                active.nextElementSibling.focus();
            } else if(active === allBtn){
                favBtn.focus();
            } else if(active === favBtn){
                categoriesBtns[0]?.focus();
            } else if(categoriesBtns.includes(active)){
                const idx = categoriesBtns.indexOf(active);
                if(idx < categoriesBtns.length-1) categoriesBtns[idx+1].focus();
            }
            break;

        case "ArrowRight":
            if(sidebar.contains(active) && channelsDivs.length){
                channelsDivs[0].focus();
            }
            break;

        case "ArrowLeft":
            if(active.classList.contains('channel')){
                allBtn.focus();
            }
            break;

        case "Enter":
            if(active) active.click();
            break;

        case "Backspace":
        case "Escape":
            if(videoContainer.classList.contains("active")) document.getElementById("exitBtn").click();
            break;
    }

    e.preventDefault();
});
</script>

</body>
</html>
