<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Editor de Foto & Designer</title>
<style>
body { margin:0; font-family: 'Segoe UI', sans-serif; display:flex; height:100vh; background:#f7f8fb; color:#333 }
#sidebar { width:340px; background:#fff; border-right:1px solid #ddd; display:flex; flex-direction:column; box-shadow:2px 0 8px rgba(0,0,0,.05); }
#sidebar h3 { margin:12px 0 6px; font-size:16px; color:#444 }
#sidebar input, #sidebar select, #sidebar button { width:100%; padding:8px 10px; margin:4px 0; border:1px solid #ccc; border-radius:6px; font-size:14px }
#sidebar button { cursor:pointer; background:#4a90e2; color:#fff; border:none; transition:background .2s }
#sidebar button:hover { background:#357abd }
#sidebar .danger { background:#e94e4e }
#sidebar .danger:hover { background:#c0392b }
.project-item { background:#f9f9f9; margin:4px 0; padding:8px; border-radius:6px; display:flex; justify-content:space-between; align-items:center; font-size:13px }
.project-item strong { display:block; font-size:14px; margin-bottom:2px }
.project-item button { width:auto; margin-left:6px; padding:4px 8px; font-size:12px }
#canvas-wrap { flex:1; display:flex; flex-direction:column; }
#controls { padding:10px; background:#fff; border-bottom:1px solid #ddd; display:flex; align-items:center; gap:10px; box-shadow:0 2px 6px rgba(0,0,0,.05); }
#controls strong { font-size:15px; color:#555 }
canvas { background:#fff; margin:auto; border:1px solid #ddd; box-shadow:0 4px 12px rgba(0,0,0,.1); border-radius:8px }
#selInfo { background:#f1f1f1; padding:6px; border-radius:4px; font-size:13px; margin-top:6px }
.filter-control { display:flex; align-items:center; gap:6px; margin:4px 0 }
.filter-control label { flex:1; font-size:13px; color:#555 }
.filter-control input { flex:1 }
.section { margin-top:12px; }
.thumbnail { width:50px; height:50px; margin:4px; cursor:pointer; border:1px solid #ccc; border-radius:4px; object-fit:contain }
.thumbnails { display:flex; flex-wrap:wrap; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div id="sidebar">
<div style="padding:16px; overflow-y:auto; flex:1">
<h3>Projetos</h3>
<input id="projectName" placeholder="Nome do projeto" />
<button id="saveBtn">Salvar</button>
<button id="saveAsBtn">Salvar como novo</button>
<button id="clearBtn" class="danger">Novo projeto</button>
<h3>Meus Projetos</h3>
<div id="projectsList"></div>

<h3>Adicionar elementos</h3>
<input type="file" id="imgUpload" accept="image/*" />
<input id="textInput" placeholder="Digite um texto" />
<button id="addTextBtn">Adicionar Texto</button>

<h3>Estilo do Texto</h3>
<select id="fontSelect">
<option value="Arial">Arial</option>
<option value="Helvetica">Helvetica</option>
<option value="Times New Roman">Times New Roman</option>
<option value="Courier New">Courier New</option>
<option value="Impact">Impact</option>
</select>
<input type="color" id="fillColor" value="#000000" />
<input id="fontSize" type="number" value="36" />
<button id="boldBtn">Negrito</button>
<button id="italicBtn">Itálico</button>

<h3>Formas</h3>
<button id="addRect">Quadrado</button>
<button id="addCircle">Círculo</button>
<button id="addLine">Linha</button>

<h3>Stickers</h3>
<div class="thumbnails" id="stickers">
<img src="https://cdn-icons-png.flaticon.com/128/616/616408.png" class="thumbnail">
<img src="https://cdn-icons-png.flaticon.com/128/616/616408.png" class="thumbnail">
</div>
<input type="file" id="stickerUpload" accept="image/*" />

<h3>Fundos</h3>
<div class="thumbnails" id="backgrounds">
<div class="thumbnail" style="background:linear-gradient(135deg,#ff9a9e,#fad0c4)"></div>
<div class="thumbnail" style="background:linear-gradient(135deg,#a1c4fd,#c2e9fb)"></div>
</div>
<input type="color" id="bgColor" />
<input type="file" id="bgUpload" accept="image/*" />

<h3>Filtros</h3>
<div class="filter-control"><label>Brilho</label><input type="range" id="brightness" min="-1" max="1" step="0.1" value="0"></div>
<div class="filter-control"><label>Contraste</label><input type="range" id="contrast" min="-1" max="1" step="0.1" value="0"></div>
<div class="filter-control"><label>Saturação</label><input type="range" id="saturation" min="-1" max="1" step="0.1" value="0"></div>
<div class="filter-control"><label>Blur</label><input type="range" id="blur" min="0" max="1" step="0.05" value="0"></div>

<h3>Exportar</h3>
<button id="exportPNG">Salvar em PNG</button>
<button id="exportJPG">Salvar em JPG</button>
<button id="exportPDF">Salvar em PDF</button>

<h3>Selecionado</h3>
<div id="selInfo">Nenhum</div>
<button id="bringFront">Trazer para frente</button>
<button id="sendBack">Enviar para trás</button>
<button id="deleteObj" class="danger">Excluir</button>
</div>
</div>

<div id="canvas-wrap">
<div id="controls">
<strong>Editor de Fotos & Designer</strong>
<span style="flex:1"></span>
<label style="font-size:13px;color:#666">Tamanho:</label>
<select id="canvasSize">
<option value="800x600">800×600</option>
<option value="1024x768" selected>1024×768</option>
<option value="1280x720">1280×720</option>
<option value="1920x1080">1920×1080</option>
</select>
</div>
<canvas id="c" width="1024" height="768"></canvas>
</div>

<script>
const canvas=new fabric.Canvas('c',{backgroundColor:'#fff'});

// IndexedDB para salvar projetos
let db;
const request=indexedDB.open('EditorDB',1);
request.onupgradeneeded=e=>{
  db=e.target.result;
  db.createObjectStore('projects',{keyPath:'name'});
};
request.onsuccess=e=>{db=e.target.result;loadProjects();};

function saveProject(name){
  const tx=db.transaction('projects','readwrite');
  const store=tx.objectStore('projects');
  const data={name,content:canvas.toJSON()};
  store.put(data);
  loadProjects();
}
function loadProjects(){
  const tx=db.transaction('projects','readonly');
  const store=tx.objectStore('projects');
  const list=document.getElementById('projectsList');
  list.innerHTML='';
  store.openCursor().onsuccess=e=>{
    const cursor=e.target.result;
    if(cursor){
      const div=document.createElement('div');
      div.className='project-item';
      div.innerHTML=`<strong>${cursor.key}</strong><div><button onclick="loadProject('${cursor.key}')">Abrir</button></div>`;
      list.appendChild(div);
      cursor.continue();
    }
  };
}
function loadProject(name){
  const tx=db.transaction('projects','readonly');
  const store=tx.objectStore('projects');
  store.get(name).onsuccess=e=>{
    const data=e.target.result;
    if(data){
      canvas.loadFromJSON(data.content,()=>canvas.renderAll());
    }
  };
}

// Adicionar texto
document.getElementById('addTextBtn').addEventListener('click',()=>{
  const txt=document.getElementById('textInput').value||'Texto';
  const t=new fabric.Textbox(txt,{ left:50, top:50, fontFamily:document.getElementById('fontSelect').value, fill:document.getElementById('fillColor').value, fontSize:Number(document.getElementById('fontSize').value)});
  canvas.add(t).setActiveObject(t);
});

// Formas
document.getElementById('addRect').addEventListener('click',()=>{
  canvas.add(new fabric.Rect({width:100,height:100,left:50,top:50,fill:'#ff5722'})).setActiveObject(canvas.item(canvas.size()-1));
});
document.getElementById('addCircle').addEventListener('click',()=>{
  canvas.add(new fabric.Circle({radius:50,left:50,top:50,fill:'#4caf50'})).setActiveObject(canvas.item(canvas.size()-1));
});
document.getElementById('addLine').addEventListener('click',()=>{
  canvas.add(new fabric.Line([50,50,150,150],{stroke:'#2196f3',strokeWidth:4})).setActiveObject(canvas.item(canvas.size()-1));
});

// Stickers
document.querySelectorAll('#stickers img').forEach(img=>{ img.addEventListener('click',()=>{ fabric.Image.fromURL(img.src,i=>{canvas.add(i).setActiveObject(i);}); }); });
document.getElementById('stickerUpload').addEventListener('change',e=>{
  const f=e.target.files[0]; if(!f)return;
  const reader=new FileReader(); reader.onload=ev=>{
    fabric.Image.fromURL(ev.target.result,i=>canvas.add(i).setActiveObject(i));
  }; reader.readAsDataURL(f);
});

// Fundos
document.querySelectorAll('#backgrounds .thumbnail').forEach(d=>{
  d.addEventListener('click',()=>{
    canvas.setBackgroundColor(d.style.background,canvas.renderAll.bind(canvas));
  });
});
document.getElementById('bgColor').addEventListener('change',e=>{
  canvas.setBackgroundColor(e.target.value,canvas.renderAll.bind(canvas));
});
document.getElementById('bgUpload').addEventListener('change',e=>{
  const f=e.target.files[0]; if(!f)return;
  const reader=new FileReader(); reader.onload=ev=>{
    fabric.Image.fromURL(ev.target.result,i=>{
      i.set({left:0,top:0,selectable:false,width:canvas.width,height:canvas.height,originX:'left',originY:'top'});
      canvas.setBackgroundImage(i,canvas.renderAll.bind(canvas));
    });
  }; reader.readAsDataURL(f);
});

// Filtros
function applyFilters(){
  const obj=canvas.getActiveObject(); if(obj && obj.type==='image'){
    obj.filters=[];
    const brightness=parseFloat(document.getElementById('brightness').value);
    const contrast=parseFloat(document.getElementById('contrast').value);
    const saturation=parseFloat(document.getElementById('saturation').value);
    const blur=parseFloat(document.getElementById('blur').value);
    if(brightness!==0)obj.filters.push(new fabric.Image.filters.Brightness({brightness}));
    if(contrast!==0)obj.filters.push(new fabric.Image.filters.Contrast({contrast}));
    if(saturation!==0)obj.filters.push(new fabric.Image.filters.Saturation({saturation}));
    if(blur>0)obj.filters.push(new fabric.Image.filters.Blur({blur}));
    obj.applyFilters(); canvas.renderAll();
  }
}
document.querySelectorAll('#brightness,#contrast,#saturation,#blur').forEach(i=>i.addEventListener('input',applyFilters));

// Exportar
function exportPNG(){canvas.discardActiveObject(); canvas.renderAll(); const link=document.createElement('a'); link.href=canvas.toDataURL({format:'png'}); link.download='design.png'; link.click();}
document.getElementById('exportPNG').addEventListener('click',exportPNG);

function exportJPG(){canvas.discardActiveObject(); canvas.renderAll(); const link=document.createElement('a'); link.href=canvas.toDataURL({format:'jpeg'}); link.download='design.jpg'; link.click();}
document.getElementById('exportJPG').addEventListener('click',exportJPG);

function exportPDF(){const { jsPDF }=window.jspdf; const pdf=new jsPDF('l', 'px', [canvas.width,canvas.height]); pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0,0,canvas.width,canvas.height); pdf.save('design.pdf');}
document.getElementById('exportPDF').addEventListener('click',exportPDF);
</script>
</body>
</html>
