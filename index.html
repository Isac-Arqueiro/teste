<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Leitor de Filmes Fullscreen</title>
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f8f8; }
    h2 { text-align: center; }
    #playerContainer { position: relative; margin-top: 20px; }
    #player { width: 100%; height: 480px; background: black; }
    #controls { margin-top: 10px; text-align: center; }
    button { padding: 8px 16px; margin: 0 6px; cursor: pointer; }
    .item { display: flex; align-items: center; padding: 6px; border-bottom: 1px solid #ddd; cursor: pointer; background: #fff; margin-bottom: 4px; border-radius: 4px; }
    .item:hover { background: #e6e6e6; }
    .item img { width: 60px; height: 90px; object-fit: cover; margin-right: 10px; border-radius: 4px; }
    .info { display: flex; flex-direction: column; }
    .nome { font-weight: bold; }
    .categoria { font-size: 12px; color: gray; }
    .botoes { margin-bottom: 10px; text-align: center; }
    input { padding: 6px; width: 60%; margin-right: 6px; }
  </style>
</head>
<body>
  <h2>🎬 Leitor de Filmes Fullscreen</h2>

  <div class="botoes">
    <button onclick="mostrarListaInterna()">Lista Interna</button>
    <input type="text" id="novaURL" placeholder="Adicionar URL de filme (.mp4, .mkv...)">
    <button onclick="adicionarFilme()">Adicionar Filme</button>
  </div>

  <div id="lista"></div>

  <div id="playerContainer">
    <div id="player"></div>
    <div id="controls" style="display:none;">
      <button onclick="pausarFilme()">⏸ Pausar</button>
      <button onclick="pararFilme()">⏹ Parar</button>
    </div>
  </div>

<script>
// =============================
// LISTA INTERNA INICIAL
// =============================
let listaFilmes = `#EXTINF:-1 tvg-name="Premonição 6: Laços de Sangue (2025)" tvg-logo="https://image.tmdb.org/t/p/w600_and_h900_bestv2/niTRdfNCT29PXU9YpPPuISrBIw7.jpg" group-title="FILMES | 4K",Premonição 6: Laços de Sangue (2025)
http://facilita.fun:80/movie/TeamKakashi/4321123/11286529.mp4
#EXTINF:-1 tvg-name="Missão Resgate: Vingança (2025)" tvg-logo="https://image.tmdb.org/t/p/w600_and_h900_bestv2/sPTeizmI8p40oEuvbIc2B3H5mg6.jpg" group-title="FILMES | LEGENDADOS",Missão Resgate: Vingança (2025)
http://facilita.fun:80/movie/TeamKakashi/4321123/11286536.mp4
#EXTINF:-1 tvg-name="Hurry Up Tomorrow: Além dos Holofotes (2025)" tvg-logo="https://image.tmdb.org/t/p/w600_and_h900_bestv2/jZJgfez0ilFqtJKljCigK4YbB1v.jpg" group-title="FILMES | SUGESTÃO DA SEMANA",Hurry Up Tomorrow: Além dos Holofotes (2025)
http://facilita.fun:80/movie/TeamKakashi/4321123/11286540.mp4
#EXTINF:-1 tvg-name="O Inimigo Está Por Perto (2023)" tvg-logo="https://image.tmdb.org/t/p/w600_and_h900_bestv2/bc6CI6cTv30SDWtSutfHb6aGix.jpg" group-title="FILMES | SUGESTÃO DA SEMANA",O Inimigo Está Por Perto (2023)
http://facilita.fun:80/movie/TeamKakashi/4321123/11286541.mp4
`;

let player = null; // instância do Clappr
let filmeAtual = null;

// =============================
// FUNÇÃO: PROCESSAR M3U
// =============================
function processarM3U(txt) {
  let linhas = txt.split("\n");
  let itens = [];
  let atual = {};
  linhas.forEach(l => {
    if (l.startsWith("#EXTINF")) {
      let logoMatch = l.match(/tvg-logo="(.*?)"/);
      let nomeMatch = l.match(/tvg-name="(.*?)"/);
      let grupoMatch = l.match(/group-title="(.*?)"/);
      atual = {
        nome: nomeMatch ? nomeMatch[1] : "Sem nome",
        logo: logoMatch ? logoMatch[1] : "https://via.placeholder.com/100?text=SEM+LOGO",
        categoria: grupoMatch ? grupoMatch[1] : "Sem categoria"
      };
    } else if (l.startsWith("http")) {
      atual.url = l.trim();
      itens.push(atual);
    }
  });
  return itens;
}

// =============================
// FUNÇÃO: MOSTRAR LISTA
// =============================
function mostrarListaInterna() {
  const itens = processarM3U(listaFilmes);
  let div = document.getElementById("lista");
  div.innerHTML = "";
  itens.forEach(item => {
    let el = document.createElement("div");
    el.className = "item";
    el.innerHTML = `
      <img src="${item.logo}">
      <div class="info">
        <div class="nome">${item.nome}</div>
        <div class="categoria">${item.categoria}</div>
      </div>
    `;
    el.onclick = () => abrirPlayer(item.url);
    div.appendChild(el);
  });
}

// =============================
// FUNÇÃO: ABRIR PLAYER FULLSCREEN
// =============================
function abrirPlayer(url) {
  filmeAtual = url;
  document.getElementById("controls").style.display = "block";
  document.getElementById("player").innerHTML = "";
  player = new Clappr.Player({
    source: url,
    parentId: "#player",
    width: "100%",
    height: window.innerHeight,
    autoPlay: true
  });
  // Pedir fullscreen
  const elem = document.getElementById("player");
  if (elem.requestFullscreen) elem.requestFullscreen();
  else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
  else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
}

// =============================
// CONTROLES
// =============================
function pausarFilme() {
  if (player) player.pause();
}

function pararFilme() {
  if (player) {
    player.stop();
    document.getElementById("player").innerHTML = "";
    document.getElementById("controls").style.display = "none";
  }
}

// =============================
// ADICIONAR FILME
// =============================
function adicionarFilme() {
  let url = document.getElementById("novaURL").value.trim();
  if (!url) return alert("Digite a URL do filme");
  listaFilmes += `#EXTINF:-1,tvg-name="Novo Filme" group-title="FILMES ADICIONADOS",Novo Filme\n${url}\n`;
  document.getElementById("novaURL").value = "";
  mostrarListaInterna();
}
</script>
</body>
</html>
