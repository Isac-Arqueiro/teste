<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPTV Smart TV</title>
<link rel="icon" href="https://i.imgur.com/jFQiZvL.jpeg">

<style>
body{
    margin:0;
    padding:0;
    background:#101010;
    color:#fff;
    font-family:sans-serif;
    overflow:hidden;
}

/* LOGIN */
#login{
    height:100vh;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    gap:15px;
}
#login input{
    padding:12px;
    width:260px;
    text-align:center;
    border-radius:6px;
    border:none;
    background:#222;
    color:#fff;
}
#login button{
    padding:10px 20px;
    border:none;
    border-radius:6px;
    background:#1e90ff;
    color:#fff;
    cursor:pointer;
}

/* LAYOUT 3 COLUNAS */
.container{
    display:none;
    height:100vh;
    flex-direction:row;
}

/* SIDEBAR ESQUERDA */
.sidebar{
    width:260px;
    background:#111;
    overflow-y:auto;
    padding:10px;
}
.sidebar button{
    width:100%;
    padding:10px;
    margin:5px 0;
    background:#181818;
    border:none;
    color:#fff;
    border-radius:6px;
    cursor:pointer;
}
.sidebar button:focus{
    outline:2px solid #1e90ff;
}

/* LISTA DE CANAIS (MEIO) */
#channelList{
    flex:1;
    overflow-y:auto;
    padding:10px;
}

.channel{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:8px;
    border-radius:6px;
    cursor:pointer;
    background:#181818;
    margin:4px 0;
}
.channel img{
    width:55px;
    height:55px;
    margin-right:10px;
    border-radius:4px;
}
.channel .info{
    display:flex;
    align-items:center;
}
.channel:focus{
    outline:2px solid #1e90ff;
    background:#222;
}

.star{
    font-size:26px;
    cursor:pointer;
    margin-left:10px;
    color:#ccc;
}
.star.fav{
    color:gold;
}

/* PLAYER LATERAL (40%) */
#playerSide{
    width:40%;
    background:#000;
    display:none;
    position:relative;
}

#playerSide video{
    width:100%;
    height:100%;
    background:#000;
}

.player-controls{
    position:absolute;
    bottom:15px;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    gap:10px;
}
.player-controls button{
    padding:6px 12px;
    border-radius:6px;
    background:rgba(0,0,0,0.55);
    color:#fff;
    border:1px solid #333;
    cursor:pointer;
    font-size:14px;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login">
  <h2>Bem-vindo ao IPTV</h2>
  <input type="password" id="password" placeholder="Digite a senha">
  <button id="loginBtn">Entrar</button>
</div>

<!-- ÁREA PRINCIPAL -->
<div class="container">

  <!-- SIDEBAR ESQUERDA -->
  <div class="sidebar">
    <button id="btnAll">Todas Categorias</button>
    <button id="btnFav">Favoritos ⭐</button>
    <div id="categories"></div>
  </div>

  <!-- LISTA DE CANAIS (MEIO) -->
  <div id="channelList"></div>

  <!-- PLAYER (DIREITA 40%) -->
  <div id="playerSide">
      <video id="video" playsinline webkit-playsinline></video>

      <div class="player-controls">
          <button id="exitBtn">Menu</button>
          <button id="prevBtn">⏮️</button>
          <button id="nextBtn">⏭️</button>
      </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
/* ==================
     CONFIG
=================== */
const validPasswords = ["2025","A0C02550","A0X02551","A0Z02552"];
const playlistUrl = "https://raw.githubusercontent.com/Isac-Arqueiro/vip01/refs/heads/main/canais";

let allChannels = [];
let currentList = [];
let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");

let currentIndex = 0;
let hls = null;

/* ELEMENTOS */
const loginDiv = document.getElementById("login");
const container = document.querySelector(".container");

const channelListDiv = document.getElementById("channelList");
const categoriesDiv = document.getElementById("categories");

const videoContainer = document.getElementById("playerSide");
const videoEl = document.getElementById("video");

/* LOGIN */
document.getElementById("loginBtn").onclick = () => {
    const pw = document.getElementById("password").value;
    if(validPasswords.includes(pw)){
        localStorage.setItem("iptv_pw", pw);
        loginDiv.style.display="none";
        container.style.display="flex";
        loadPlaylist();
    } else alert("Senha incorreta!");
};

window.onload = () => {
    if(validPasswords.includes(localStorage.getItem("iptv_pw"))){
        loginDiv.style.display="none";
        container.style.display="flex";
        loadPlaylist();
    }
};

/* ==================
     CARREGAR LISTA
=================== */
async function loadPlaylist(){
    try {
        const res = await fetch(playlistUrl);
        const txt = await res.text();
        allChannels = parseM3U(txt);
        renderCategories();
        renderChannels(allChannels); // mostra todos ao abrir
    } catch {
        alert("Erro ao carregar lista");
    }
}

function parseM3U(txt){
    const lines = txt.split("\n");
    const result = [];
    let c = null;

    lines.forEach(l=>{
        l = l.trim();

        if(l.startsWith("#EXTINF")){
            c = {
                tvg_name:(l.match(/tvg-name="([^"]+)"/)||["","Sem Nome"])[1],
                tvg_logo:(l.match(/tvg-logo="([^"]+)"/)||["",""])[1],
                group_title:(l.match(/group-title="([^"]+)"/)||["","Outros"])[1]
            };
        } 
        else if(l && c){
            c.url = l;
            result.push(c);
            c = null;
        }
    });

    return result;
}

/* ==================
     CATEGORIAS
=================== */
function renderCategories(){
    const cats = [...new Set(allChannels.map(c=>c.group_title))];
    categoriesDiv.innerHTML="";

    cats.forEach(cat=>{
        const btn = document.createElement("button");
        btn.textContent = cat;
        btn.onclick = () => {
            currentList = allChannels.filter(c=>c.group_title===cat);
            renderChannels(currentList);
        };
        categoriesDiv.appendChild(btn);
    });

    document.getElementById("btnAll").onclick = () => {
        currentList = allChannels;
        renderChannels(allChannels);
    };

    document.getElementById("btnFav").onclick = () => {
        currentList = allChannels.filter(c => favorites.includes(c.tvg_name));
        renderChannels(currentList);
    };

    currentList = allChannels;
}

/* ==================
     RENDER CANAIS
=================== */
function renderChannels(list){
    channelListDiv.innerHTML="";
    currentList = list;

    list.forEach((c, i)=>{
        const div = document.createElement("div");
        div.className = "channel";
        div.tabIndex = 0;

        const info = document.createElement("div");
        info.className="info";
        info.innerHTML = `<img src="${c.tvg_logo || 'https://via.placeholder.com/50'}"><span>${c.tvg_name}</span>`;

        const star = document.createElement("span");
        star.className = "star " + (favorites.includes(c.tvg_name) ? "fav" : "");
        star.innerHTML = "⭐";

        star.onclick = (e) => {
            e.stopPropagation();
            toggleFavorite(c, star);
        };

        div.appendChild(info);
        div.appendChild(star);

        div.onclick = () => {
            currentIndex = i;
            playChannel(c);
        };

        channelListDiv.appendChild(div);
    });
}

/* FAVORITOS */
function toggleFavorite(c, star){
    if(favorites.includes(c.tvg_name)){
        favorites = favorites.filter(x => x !== c.tvg_name);
        star.classList.remove("fav");
    } else {
        favorites.push(c.tvg_name);
        star.classList.add("fav");
    }
    localStorage.setItem("favorites", JSON.stringify(favorites));
}

/* ==================
     PLAYER LATERAL
=================== */
function playChannel(c){
    videoContainer.style.display = "block";

    if(hls){ hls.destroy(); hls=null; }

    videoEl.pause();
    videoEl.src = "";

    if(c.url.includes(".m3u8") && Hls.isSupported()){
        hls=new Hls({enableWorker:false});
        hls.loadSource(c.url);
        hls.attachMedia(videoEl);
        hls.on(Hls.Events.MANIFEST_PARSED,()=>videoEl.play());
    } else {
        videoEl.src = c.url;
        videoEl.play().catch(()=>{});
    }

    /* foca no player ao carregar */
    setTimeout(()=>videoEl.focus(),200);
}

/* ==================
     CONTROLES PLAYER
=================== */
document.getElementById("exitBtn").onclick = () => {
    videoEl.pause();
    videoContainer.style.display="none";
};

document.getElementById("prevBtn").onclick = () => {
    currentIndex = (currentIndex - 1 + currentList.length) % currentList.length;
    playChannel(currentList[currentIndex]);
};

document.getElementById("nextBtn").onclick = () => {
    currentIndex = (currentIndex + 1) % currentList.length;
    playChannel(currentList[currentIndex]);
};

/* OK = FULLSCREEN */
videoEl.onclick = () => {
    if(videoEl.requestFullscreen) videoEl.requestFullscreen();
};

/* ==================
     NAVEGAÇÃO TV BOX
=================== */
document.addEventListener("keydown", e=>{
    const active = document.activeElement;
    const channels = [...document.querySelectorAll(".channel")];
    const cats = [...document.querySelectorAll(".sidebar button")];

    switch(e.key){

        case "ArrowUp":
            if(active.classList.contains("channel")){
                if(active.previousElementSibling) active.previousElementSibling.focus();
            } else if(cats.includes(active)){
                let i = cats.indexOf(active);
                if(i>0) cats[i-1].focus();
            }
            break;

        case "ArrowDown":
            if(active.classList.contains("channel")){
                if(active.nextElementSibling) active.nextElementSibling.focus();
            } else if(cats.includes(active)){
                let i = cats.indexOf(active);
                if(i<cats.length-1) cats[i+1].focus();
            }
            break;

        case "ArrowRight":
            if(cats.includes(active) && channels.length){
                channels[0].focus();
            }
            else if(active.classList.contains("channel")){
                videoEl.focus();
            }
            break;

        case "ArrowLeft":
            if(videoEl === active){
                if(channels.length) channels[0].focus();
            }
            else if(active.classList.contains("channel")){
                cats[0].focus();
            }
            break;

        case "Enter":
            if(active === videoEl){
                if(videoEl.requestFullscreen) videoEl.requestFullscreen();
            } else active.click();
            break;

        case "Backspace":
        case "Escape":
            if(document.fullscreenElement){
                document.exitFullscreen();
            } else if(videoContainer.style.display==="block"){
                videoContainer.style.display="none";
                channels[0]?.focus();
            }
            break;
    }

    e.preventDefault();
});
</script>

</body>
</html>
